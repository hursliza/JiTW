<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pl" lang="pl">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
   <?php
	include 'menu.php';

	$nazwa = "";
	if (isset($_GET['nazwa'])) {
		$cos=$_GET['nazwa'];
		$nazwa = "blogs/".$cos;
	}

        if ($nazwa == "") {
        foreach (new DirectoryIterator("./blogs/") as $blog) {
             if ($blog->isDir() && !$blog->isDot()) {
                $blog = $blog->getFilename();
                echo sprintf("<a href=\"blog.php?nazwa=%s\">%s</a><br />", $blog, $blog);
             }
         }

      } else {

			$exist = false;
			$blog = "./" . $name . "/";
			if (file_exists($blog)) {
				$exist = true;
				$content = fopen($blog . "info.txt", 'r');
				$line_num = 1;
				while (($line = fgets($content)) !== false) {
					if ($line_num == 1) {
						echo "<h1>Blog użytkownika: " . $line . "</h1><h2>Opis bloga:</h2>";
					} else if ($line_num > 2) {
						echo "<p>". $line . "</p>";
					}
					$line_number = $line_number + 1;
				}
				fclose($content);


				$pat = '/\\d{16}$/';
				foreach (new DirectoryIterator($blog) as $file) {
					if (!$fi->isDir() && preg_match($pat, $file)){
						$cont = file_get_contents($fi->getPathName());
						echo "<h2>Wpis: " . $file . "</h2>";
						echo $cont . "<br />";

						$pata = '/' . $fi . '[1-3]/';
						foreach (new DirectoryIterator($dirb) as $fia) {
							if (preg_match($pata, $fia)) {
						    		echo sprintf('Dołączony plik: <a href="./%s/%s">%s</a><br />', $nazwa, $fia, $fia);
						 	}
						}
						echo "<br />";

						if (file_exists($dirb . $fi . ".k")) {
							foreach (new DirectoryIterator($dirb . $fi . ".k") as $plk) {
								if(!$plk->isDot() && !$plk->isDir()){

									$fic = fopen($plk->getPathName(), 'r');
									$line_number = 1;
									while (($line = fgets($fic)) !== false) {
										if ($line_number == 1) {
											echo "<strong>Typ komentarza: </strong>" . $line . "<br />";
										} else if ($line_number == 2) {
											echo "<strong>Data komentarza: </strong>" . $line . "<br />";
										} else if ($line_number == 3) {
											echo "<strong>Autor komentarza: </strong>" . $line . "<br />";
										} else if ($line_number >= 4) {
											echo $line . "<br />";
										}
										$line_number = $line_number + 1;
									}
									fclose($fic);
									echo "<br />";

								}
							}
						}
						echo sprintf('<a href="./stworzKomentarzFormularz.php?nazwa=%s/%s">Skomentuj wpis</a><br />', $cos, $fi);
					}
				}
      }

		if (!$exist) {
			echo "Nie znaleziono blogu ! <br />";
		}
	}

   ?>
</body>
</html>
